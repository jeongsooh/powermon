{% extends "base.html" %}

{% block contents %}
{% load static %}
<div class="row mt-2 mx-2">
  <div class="col-sm-2">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">현재사용전력</h5>
        <p class="card-text"><h3>89 kW</h3></p>
      </div>
    </div>
  </div>
  <div class="col-sm-2">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">당일 피크전력</h5>
        <p class="card-text"><h3>150 kW</h3></p>
      </div>
    </div>
  </div>
  <div class="col-sm-2">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">당월 피크전력</h5>
        <p class="card-text"><h3>200 kW</h3></p>
      </div>
    </div>
  </div>
  <div class="col-sm-2">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">피크전력 관리목표</h5>
        <p class="card-text"><h3>400 kW</h3></p>
      </div>
    </div>
  </div>
  <div class="col-sm-2">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">요금적용전력</h5>
        <p class="card-text"><h3>600 kW</h3></p>
      </div>
    </div>
  </div>
  <div class="col-sm-2">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">계약전력</h5>
        <p class="card-text"><h3>800 kW</h3></p>
      </div>
    </div>
  </div>
</div>
<div class="row mt-5 mx-2">
  <div class="col-sm-9">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">실시간 사용추이</h5>
        <div id="chartContainer" style="height: 370px; width: 100%;"></div>
      </div>
    </div>
  </div>
  <div class="col-sm-3">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">피크전력 관리목표 대비 사용현황</h5>
        <div id="myChart2" style="width:100%; max-width:600px; height:500px;"></div>
      </div>
    </div>
  </div>
</div>
<div class="row mt-5 mx-2">
  <div class="col-sm-4">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">이번 달 전력사용량</h5>
        <p class="card-text"><h3>800 kW</h3></p>
      </div>
    </div>
  </div>
  <div class="col-sm-4">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">이번 달 요금시간대 별 전력사용량</h5>
        <p class="card-text"><h3>800 kW</h3></p>
      </div>
    </div>
  </div>
  <div class="col-sm-4">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">이번 달 사용요금</h5>
        <p class="card-text"><h3>800 kW</h3></p>
      </div>
    </div>
  </div>
</div>
<script src="{% static 'jquery-3.3.1.min.js' %}"></script>
<script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>

<script>
// $("#btn_show").click(function(){
//     com=$("#comport").val();
//     fill_graph_sensor(com);
// });
com="com3"

fill_graph_sensor(com);

function fill_graph_sensor(){
  var dps = []; // dataPoints
  var chart = new CanvasJS.Chart("chartContainer", {
    animationEnabled: true,
    title: {
      text: ""
    },
    axisX: {
      title: "Time"
    },
    axisY: {
      title: "Power",
      suffix: ""
    },
    data: [{
      type: "line",
      name: "CPU Utilization",
      connectNullData: true,
      //nullDataLineDashType: "solid",
      xValueType: "dateTime",
      xValueFormatString: "DD MMM hh:mm TT",
      yValueFormatString: "#,##0.##\"mm\"",
      dataPoints: dps
    }]
  });

var xVal = 0;
var yVal = 100;
var updateInterval = 1000;//miliseconds
var dataLength = 20; // number of dataPoints visible at any point

var updateChart = function () {
  $.ajax({
    type:"get",
    url: "{% url 'fetch_sensor_values_ajax' %}",
    data: {
      'id': com
    },
    success: function(data) {
      console.log(data.result);
      for(index = 0; index < data.result.length; index++) {
        var str_array = data.result[index].split(',');
        dps.push({
          x: Date.parse(str_array[1]),
          y: Number(str_array[0])
        });
      }
      return data;
    },
    error: function() {
      console.log("error he ji");
    }
  });
	if (dps.length > dataLength) {
		dps.shift();
	}
	chart.render();
};

updateChart(dataLength);
setInterval(function(){updateChart()}, updateInterval);
}
</script>
<script>
  google.charts.load('current', {'packages':['corechart']});
  google.charts.setOnLoadCallback(drawChart);
  
  function drawChart() {
  var data = google.visualization.arrayToDataTable([
    ['Contry', 'Mhl'],
    ['Italy',54.8],
    ['France',48.6],
    ['Spain',44.4],
    ['USA',23.9],
    ['Argentina',14.5]
  ]);
  
  var options = {
    // title:'World Wide Wine Production'
  };
  
  var chart = new google.visualization.PieChart(document.getElementById('myChart2'));
    chart.draw(data, options);
  }
</script>
{% endblock %}